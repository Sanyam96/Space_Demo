<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
  <head>
    <title>Space Demo</title>
    <link href="/css/style.css" media="all" rel="stylesheet" type="text/css"/>  
	<script language="javascript" src="javascripts/util.js" type="text/javascript"></script>
	<script language="javascript" src="javascripts/sprite.js" type="text/javascript"></script>
	<script language="javascript" src="scripts/sound.js" type="text/javascript"></script>
  </head>
  <body>
    <div>Hello World</div>

    <script type="text/javascript">
    
      var CANVAS_WIDTH = 480;
      var CANVAS_HEIGHT = 320;
      var canvasElement = $("<canvas width='" + CANVAS_WIDTH + "' height='" + CANVAS_HEIGHT + "'></canvas");
      var canvas = canvasElement.get(0).getContext("2d");
      canvasElement.appendTo('body');
      // canvas.rect(0, 0, CANVAS_WIDTH, CANVAS_HEIGHT); 
      // canvas.fillStyle = "#BCBCBC";
      // canvas.fill();

      var FPS = 30;
      setInterval(function() {
          update();
          draw();
      }, 1000/FPS);  


      var textX = 50;
      var textY = 50;

      

      var player = {
        color: "#00A",
        x: 220,
        y: 270,
        width: 32,
        height: 32,
        draw: function() {
          canvas.fillStyle = this.color;
          canvas.fillRect(this.x, this.y, this.width, this.height);
        }
      };
      
      function draw() {
        canvas.clearRect(0, 0, CANVAS_WIDTH, CANVAS_HEIGHT);
        player.draw();
        playerBullets.forEach(function(bullet) {
    		bullet.draw();
  		});
      }
      

      function update() {
      if (keydown.space) {
        player.shoot();
      }

      if (keydown.left) {
        player.x -= 5;
      }

      if (keydown.right) {
        player.x += 5;
      }

      player.x = player.x.clamp(0, CANVAS_WIDTH - player.width);

      playerBullets.forEach(function(bullet) {
	  	bullet.update();
	  });

	  playerBullets = playerBullets.filter(function(bullet) {
    	return bullet.active;
  	  });
    }

    player.shoot = function() {
      console.log("Pew pew");
    };  

    var playerBullets = [];
    function Bullet(I) {
      I.active = true;

      I.xVelocity = 0;
      I.yVelocity = -I.speed;
      I.width = 3;
      I.height = 3;
      I.color = "#000";

      I.inBounds = function() {
        return I.x >= 0 && I.x <= CANVAS_WIDTH &&
          I.y >= 0 && I.y <= CANVAS_HEIGHT;
      };

      I.draw = function() {
        canvas.fillStyle = this.color;
        canvas.fillRect(this.x, this.y, this.width, this.height);
      };

      I.update = function() {
        I.x += I.xVelocity;
        I.y += I.yVelocity;

        I.active = I.active && I.inBounds();
      };

      return I;
    }

    player.shoot = function() {

      var bulletPosition = this.midpoint();
      playerBullets.push(Bullet({
        speed: 5,
        x: bulletPosition.x,
        y: bulletPosition.y
        }));
    };

    player.midpoint = function() {
      return {
        x: this.x + this.width/2,
        y: this.y + this.height/2
        };
    };
     
    </script>
  
  </body>
</html>
